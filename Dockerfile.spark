FROM apache/spark-py:v3.4.0

USER root

WORKDIR /app

COPY requirements-spark.txt .
RUN pip install --no-cache-dir -r requirements-spark.txt

COPY jars /opt/spark/jars/

COPY src /app/src

RUN mkdir -p /app/logs /app/data /app/checkpoints

RUN pip install numpy pandas

ENV PYTHONPATH=/app:/app/src:$PYTHONPATH

CMD ["spark-submit", \
    "--driver-memory", "2g", \
    "--executor-memory", "2g", \
    "/app/src/processing/spark_streaming_main.py"]